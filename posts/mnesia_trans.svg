<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1032px" preserveAspectRatio="none" style="width:489px;height:1032px;" version="1.1" viewBox="0 0 489 1032" width="489px" zoomAndPan="magnify"><defs><filter height="300%" id="f1i27oseedea89" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1i27oseedea89)" height="420.0602" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="94" y="82.7739"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="94" x2="94" y1="82.7739" y2="502.8341"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="104" x2="104" y1="82.7739" y2="502.8341"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="94" x2="104" y1="82.7739" y2="82.7739"/><rect fill="#FFFFFF" filter="url(#f1i27oseedea89)" height="135.118" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="94" y="545.816"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="94" x2="94" y1="545.816" y2="680.934"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="104" x2="104" y1="545.816" y2="680.934"/><rect fill="#FFFFFF" filter="url(#f1i27oseedea89)" height="240.9421" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="94" y="723.9159"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="94" x2="94" y1="723.9159" y2="964.858"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="104" x2="104" y1="723.9159" y2="964.858"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="94" x2="104" y1="964.858" y2="964.858"/><rect fill="#FFFFFF" filter="url(#f1i27oseedea89)" height="375.3541" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="99" y="127.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="99" x2="99" y1="127.4799" y2="502.8341"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="109" x2="109" y1="127.4799" y2="502.8341"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="99" x2="109" y1="127.4799" y2="127.4799"/><rect fill="#FFFFFF" filter="url(#f1i27oseedea89)" height="135.118" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="99" y="545.816"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="99" x2="99" y1="545.816" y2="680.934"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="109" x2="109" y1="545.816" y2="680.934"/><rect fill="#FFFFFF" filter="url(#f1i27oseedea89)" height="196.2361" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="99" y="723.9159"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="99" x2="99" y1="723.9159" y2="920.152"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="109" x2="109" y1="723.9159" y2="920.152"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="99" x2="109" y1="920.152" y2="920.152"/><rect fill="#FFFFFF" filter="url(#f1i27oseedea89)" height="57.706" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="104" y="445.1281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="104" x2="104" y1="445.1281" y2="502.8341"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="114" x2="114" y1="445.1281" y2="502.8341"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="104" x2="114" y1="445.1281" y2="445.1281"/><rect fill="#FFFFFF" filter="url(#f1i27oseedea89)" height="135.118" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="104" y="545.816"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="104" x2="104" y1="545.816" y2="680.934"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="114" x2="114" y1="545.816" y2="680.934"/><rect fill="#FFFFFF" filter="url(#f1i27oseedea89)" height="151.5301" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="104" y="723.9159"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="104" x2="104" y1="723.9159" y2="875.446"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="114" x2="114" y1="723.9159" y2="875.446"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="104" x2="114" y1="875.446" y2="875.446"/><rect fill="#ADD8E6" filter="url(#f1i27oseedea89)" height="13" style="stroke: #ADD8E6; stroke-width: 1.0;" width="10" x="109" y="489.8341"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="109" x2="109" y1="489.8341" y2="502.8341"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="119" x2="119" y1="489.8341" y2="502.8341"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="109" x2="119" y1="489.8341" y2="489.8341"/><rect fill="#ADD8E6" filter="url(#f1i27oseedea89)" height="29.706" style="stroke: #ADD8E6; stroke-width: 1.0;" width="10" x="109" y="545.816"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="109" x2="109" y1="545.816" y2="575.522"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="119" x2="119" y1="545.816" y2="575.522"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="109" x2="119" y1="575.522" y2="575.522"/><rect fill="#FFFFFF" filter="url(#f1i27oseedea89)" height="13" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="109" y="667.934"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="109" x2="109" y1="667.934" y2="680.934"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="119" x2="119" y1="667.934" y2="680.934"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="109" x2="119" y1="667.934" y2="667.934"/><rect fill="#FFFFFF" filter="url(#f1i27oseedea89)" height="29.706" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="109" y="723.9159"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="109" x2="109" y1="723.9159" y2="753.6219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="119" x2="119" y1="723.9159" y2="753.6219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="109" x2="119" y1="753.6219" y2="753.6219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="99" x2="99" y1="41.0679" y2="502.8341"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="99" x2="99" y1="502.8341" y2="545.816"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="99" x2="99" y1="545.816" y2="680.934"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="99" x2="99" y1="680.934" y2="723.9159"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="99" x2="99" y1="723.9159" y2="989.858"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="302.5" x2="302.5" y1="41.0679" y2="502.8341"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="302.5" x2="302.5" y1="502.8341" y2="545.816"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="302.5" x2="302.5" y1="545.816" y2="680.934"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="302.5" x2="302.5" y1="680.934" y2="723.9159"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="302.5" x2="302.5" y1="723.9159" y2="989.858"/><rect fill="#FEFECE" filter="url(#f1i27oseedea89)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="26" x="84" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="12" x="91" y="24.9659">tx</text><rect fill="#FEFECE" filter="url(#f1i27oseedea89)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="26" x="84" y="988.858"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="12" x="91" y="1010.824">tx</text><rect fill="#FEFECE" filter="url(#f1i27oseedea89)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="257.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="264.5" y="24.9659">mnesia_tm</text><rect fill="#FEFECE" filter="url(#f1i27oseedea89)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="257.5" y="988.858"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="264.5" y="1010.824">mnesia_tm</text><rect fill="#FFFFFF" filter="url(#f1i27oseedea89)" height="420.0602" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="94" y="82.7739"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="94" x2="94" y1="82.7739" y2="502.8341"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="104" x2="104" y1="82.7739" y2="502.8341"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="94" x2="104" y1="82.7739" y2="82.7739"/><rect fill="#FFFFFF" filter="url(#f1i27oseedea89)" height="135.118" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="94" y="545.816"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="94" x2="94" y1="545.816" y2="680.934"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="104" x2="104" y1="545.816" y2="680.934"/><rect fill="#FFFFFF" filter="url(#f1i27oseedea89)" height="240.9421" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="94" y="723.9159"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="94" x2="94" y1="723.9159" y2="964.858"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="104" x2="104" y1="723.9159" y2="964.858"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="94" x2="104" y1="964.858" y2="964.858"/><rect fill="#FFFFFF" filter="url(#f1i27oseedea89)" height="375.3541" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="99" y="127.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="99" x2="99" y1="127.4799" y2="502.8341"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="109" x2="109" y1="127.4799" y2="502.8341"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="99" x2="109" y1="127.4799" y2="127.4799"/><rect fill="#FFFFFF" filter="url(#f1i27oseedea89)" height="135.118" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="99" y="545.816"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="99" x2="99" y1="545.816" y2="680.934"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="109" x2="109" y1="545.816" y2="680.934"/><rect fill="#FFFFFF" filter="url(#f1i27oseedea89)" height="196.2361" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="99" y="723.9159"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="99" x2="99" y1="723.9159" y2="920.152"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="109" x2="109" y1="723.9159" y2="920.152"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="99" x2="109" y1="920.152" y2="920.152"/><rect fill="#FFFFFF" filter="url(#f1i27oseedea89)" height="57.706" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="104" y="445.1281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="104" x2="104" y1="445.1281" y2="502.8341"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="114" x2="114" y1="445.1281" y2="502.8341"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="104" x2="114" y1="445.1281" y2="445.1281"/><rect fill="#FFFFFF" filter="url(#f1i27oseedea89)" height="135.118" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="104" y="545.816"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="104" x2="104" y1="545.816" y2="680.934"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="114" x2="114" y1="545.816" y2="680.934"/><rect fill="#FFFFFF" filter="url(#f1i27oseedea89)" height="151.5301" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="104" y="723.9159"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="104" x2="104" y1="723.9159" y2="875.446"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="114" x2="114" y1="723.9159" y2="875.446"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="104" x2="114" y1="875.446" y2="875.446"/><rect fill="#ADD8E6" filter="url(#f1i27oseedea89)" height="13" style="stroke: #ADD8E6; stroke-width: 1.0;" width="10" x="109" y="489.8341"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="109" x2="109" y1="489.8341" y2="502.8341"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="119" x2="119" y1="489.8341" y2="502.8341"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="109" x2="119" y1="489.8341" y2="489.8341"/><rect fill="#ADD8E6" filter="url(#f1i27oseedea89)" height="29.706" style="stroke: #ADD8E6; stroke-width: 1.0;" width="10" x="109" y="545.816"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="109" x2="109" y1="545.816" y2="575.522"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="119" x2="119" y1="545.816" y2="575.522"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="109" x2="119" y1="575.522" y2="575.522"/><rect fill="#FFFFFF" filter="url(#f1i27oseedea89)" height="13" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="109" y="667.934"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="109" x2="109" y1="667.934" y2="680.934"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="119" x2="119" y1="667.934" y2="680.934"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="109" x2="119" y1="667.934" y2="667.934"/><rect fill="#FFFFFF" filter="url(#f1i27oseedea89)" height="29.706" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="109" y="723.9159"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="109" x2="109" y1="723.9159" y2="753.6219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="119" x2="119" y1="723.9159" y2="753.6219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="109" x2="119" y1="753.6219" y2="753.6219"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="99" x2="146" y1="69.7739" y2="69.7739"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="146" x2="146" y1="69.7739" y2="82.7739"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="105" x2="146" y1="82.7739" y2="82.7739"/><polygon fill="#A80036" points="115,78.7739,105,82.7739,115,86.7739,111,82.7739" style="stroke: #A80036; stroke-width: 1.0;"/><a href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia.erl#L418" target="_top" title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia.erl#L418" xlink:actuate="onRequest" xlink:href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia.erl#L418" xlink:show="new" xlink:title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia.erl#L418" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="114" x="111" y="63.9649">mnesia:transaction</text></a><line style="stroke: #A80036; stroke-width: 1.0;" x1="104" x2="151" y1="114.4799" y2="114.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="151" x2="151" y1="114.4799" y2="127.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="110" x2="151" y1="127.4799" y2="127.4799"/><polygon fill="#A80036" points="120,123.4799,110,127.4799,120,131.4799,116,127.4799" style="stroke: #A80036; stroke-width: 1.0;"/><a href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L761" target="_top" title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L761" xlink:actuate="onRequest" xlink:href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L761" xlink:show="new" xlink:title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L761" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="137" x="116" y="108.6709">mnesia_tm:transaction</text></a><rect fill="#EEEEEE" filter="url(#f1i27oseedea89)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="474" x="3" y="162.333"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="477" y1="162.333" y2="162.333"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="477" y1="165.333" y2="165.333"/><rect fill="#EEEEEE" filter="url(#f1i27oseedea89)" height="25.706" style="stroke: #000000; stroke-width: 2.0;" width="149" x="165.5" y="150.4799"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="132" x="171.5" y="168.377">prepare transaction</text><polygon fill="#A80036" points="291,205.892,301,209.892,291,213.892,295,209.892" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="109" x2="297" y1="209.892" y2="209.892"/><a href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L777" target="_top" title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L777" xlink:actuate="onRequest" xlink:href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L777" xlink:show="new" xlink:title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L777" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="67" x="116" y="204.083">start_outer</text></a><path d="M134,222.892 L134,249.892 L468,249.892 L468,232.892 L458,222.892 L134,222.892 " fill="#FBFB77" filter="url(#f1i27oseedea89)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M458,222.892 L458,232.892 L468,232.892 L458,222.892 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><a href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L232" target="_top" title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L232" xlink:actuate="onRequest" xlink:href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L232" xlink:show="new" xlink:title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L232" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="313" x="140" y="241.789">Create a fresh ets bag for the shadow store and a Tid</text></a><polygon fill="#A80036" points="120,279.304,110,283.304,120,287.304,116,283.304" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="114" x2="302" y1="283.304" y2="283.304"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="21" x="126" y="277.495">link</text><polygon fill="#A80036" points="120,311.01,110,315.01,120,319.01,116,315.01" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="114" x2="302" y1="315.01" y2="315.01"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="126" y="309.201">{new_tid, Tid, Etab}</text><rect fill="#EEEEEE" filter="url(#f1i27oseedea89)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="474" x="3" y="344.863"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="477" y1="344.863" y2="344.863"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="477" y1="347.863" y2="347.863"/><rect fill="#EEEEEE" filter="url(#f1i27oseedea89)" height="25.706" style="stroke: #000000; stroke-width: 2.0;" width="121" x="179.5" y="333.01"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="104" x="185.5" y="350.907">run transaction</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="109" x2="151" y1="392.4221" y2="392.4221"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="151" x2="151" y1="392.4221" y2="405.4221"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="110" x2="151" y1="405.4221" y2="405.4221"/><polygon fill="#A80036" points="120,401.4221,110,405.4221,120,409.4221,116,405.4221" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="175" x="116" y="386.6131">update mnesia_activity_store</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="109" x2="156" y1="432.1281" y2="432.1281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="156" x2="156" y1="432.1281" y2="445.1281"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="115" x2="156" y1="445.1281" y2="445.1281"/><polygon fill="#A80036" points="125,441.1281,115,445.1281,125,449.1281,121,445.1281" style="stroke: #A80036; stroke-width: 1.0;"/><a href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L841" target="_top" title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L841" xlink:actuate="onRequest" xlink:href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L841" xlink:show="new" xlink:title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L841" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="128" x="121" y="426.3191">mnesia_tm:apply_fun</text></a><line style="stroke: #A80036; stroke-width: 1.0;" x1="114" x2="161" y1="476.8341" y2="476.8341"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="161" x2="161" y1="476.8341" y2="489.8341"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="120" x2="161" y1="489.8341" y2="489.8341"/><polygon fill="#A80036" points="130,485.8341,120,489.8341,130,493.8341,126,489.8341" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="126" y="471.0251">Apply transaction fun</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="243" x="79.5" y="528.593">Read and write records, see "reads and writes"</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="119" x2="161" y1="574.522" y2="574.522"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="161" x2="161" y1="574.522" y2="587.522"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="114" x2="161" y1="587.522" y2="587.522"/><polygon fill="#A80036" points="124,583.522,114,587.522,124,591.522,120,587.522" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="126" y="568.713">Ret</text><rect fill="#EEEEEE" filter="url(#f1i27oseedea89)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="474" x="3" y="612.375"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="477" y1="612.375" y2="612.375"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="477" y1="615.375" y2="615.375"/><rect fill="#EEEEEE" filter="url(#f1i27oseedea89)" height="25.706" style="stroke: #000000; stroke-width: 2.0;" width="68" x="206" y="600.522"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="51" x="212" y="618.419">commit</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="114" x2="161" y1="654.934" y2="654.934"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="161" x2="161" y1="654.934" y2="667.934"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="120" x2="161" y1="667.934" y2="667.934"/><polygon fill="#A80036" points="130,663.934,120,667.934,130,671.934,126,667.934" style="stroke: #A80036; stroke-width: 1.0;"/><a href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1094" target="_top" title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1094" xlink:actuate="onRequest" xlink:href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1094" xlink:show="new" xlink:title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1094" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="126" x="126" y="649.125">mnesia_tm:t_commit</text></a><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="156" x="123" y="706.6929">See "commit process in detail"</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="119" x2="161" y1="752.6219" y2="752.6219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="161" x2="161" y1="752.6219" y2="765.6219"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="114" x2="161" y1="765.6219" y2="765.6219"/><polygon fill="#A80036" points="124,761.6219,114,765.6219,124,769.6219,120,765.6219" style="stroke: #A80036; stroke-width: 1.0;"/><a href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L844" target="_top" title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L844" xlink:actuate="onRequest" xlink:href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L844" xlink:show="new" xlink:title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L844" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="68" x="126" y="746.8129">do_commit</text></a><path d="M8,773.6219 L8,836.6219 L187,836.6219 L187,783.6219 L177,773.6219 L8,773.6219 " fill="#FBFB77" filter="url(#f1i27oseedea89)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M177,773.6219 L177,783.6219 L187,783.6219 L177,773.6219 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="14" y="792.519">If result wasn't do_commit</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="17" y="810.225">the tx would restart</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="17" y="827.931">transaction here</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="114" x2="156" y1="874.446" y2="874.446"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="156" x2="156" y1="874.446" y2="887.446"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="109" x2="156" y1="887.446" y2="887.446"/><polygon fill="#A80036" points="119,883.446,109,887.446,119,891.446,115,887.446" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="20" x="121" y="868.637">Ret</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="109" x2="151" y1="919.152" y2="919.152"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="151" x2="151" y1="919.152" y2="932.152"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="104" x2="151" y1="932.152" y2="932.152"/><polygon fill="#A80036" points="114,928.152,104,932.152,114,936.152,110,932.152" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="116" y="913.343">"{atomic, Ret}"</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="104" x2="146" y1="963.858" y2="963.858"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="146" x2="146" y1="963.858" y2="976.858"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="99" x2="146" y1="976.858" y2="976.858"/><polygon fill="#A80036" points="109,972.858,99,976.858,109,980.858,105,976.858" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="111" y="958.049">"{atomic, Ret}"</text><!--MD5=[00139b325db61c4934357131c3c275b5]
@startuml
participant tx
participant mnesia_tm

tx -> tx++ : [[https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia.erl#L418 mnesia:transaction]]
tx -> tx++ : [[https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L761 mnesia_tm:transaction]]

== prepare transaction ==
  tx -> mnesia_tm : [[https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L777 start_outer]]
    note over mnesia_tm: [[https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L232 Create a fresh ets bag for the shadow store and a Tid]]
  tx <- - mnesia_tm : link
  tx <- mnesia_tm : {new_tid, Tid, Etab}

== run transaction ==
  tx -> tx : update mnesia_activity_store
  tx -> tx ++ : [[https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L841 mnesia_tm:apply_fun]]
    tx -> tx++ #LightBlue : Apply transaction fun

... Read and write records, see "reads and writes" ...

    return Ret

== commit ==

    tx -> tx++ : [[https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1094 mnesia_tm:t_commit]]

... See "commit process in detail" ...

    return [[https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L844 do_commit]]

    note over tx : If result wasn't do_commit\n the tx would restart\n transaction here
  return Ret
return "{atomic, Ret}"
return "{atomic, Ret}"
@enduml

PlantUML version 1.2020.02(Sun Mar 01 11:22:07 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.11+9-Ubuntu-0ubuntu2.20.10
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>