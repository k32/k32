<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1938px" preserveAspectRatio="none" style="width:1319px;height:1938px;" version="1.1" viewBox="0 0 1319 1938" width="1319px" zoomAndPan="magnify"><defs><filter height="300%" id="f9fuwncr44an1" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" height="1923.7306" style="stroke: #A80036; stroke-width: 1.0;" width="636.5" x="123" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="89" x="396.75" y="17.897">Original node</text><rect fill="#ADD8E6" height="1923.7306" style="stroke: #A80036; stroke-width: 1.0;" width="545" x="761.5" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="86" x="991" y="17.897">Participant A</text><rect fill="#FFFFFF" filter="url(#f9fuwncr44an1)" height="1772.1828" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="137" y="105.4799"/><rect fill="#FFFFFF" filter="url(#f9fuwncr44an1)" height="1622.0647" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="142" y="239.598"/><rect fill="#FFFFFF" filter="url(#f9fuwncr44an1)" height="137.5301" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="147" y="343.716"/><rect fill="#FFFFFF" filter="url(#f9fuwncr44an1)" height="1198.5925" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="147" y="618.3642"/><rect fill="#FFFFFF" filter="url(#f9fuwncr44an1)" height="389.0602" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="152" y="1165.9544"/><rect fill="#FFFFFF" filter="url(#f9fuwncr44an1)" height="42.706" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="157" y="1467.6026"/><rect fill="#FFFFFF" filter="url(#f9fuwncr44an1)" height="805.8263" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="806" y="973.4243"/><rect fill="#FFFFFF" filter="url(#f9fuwncr44an1)" height="127.8241" style="stroke: #000000; stroke-width: 2.0;" width="942" x="117" y="638.3642"/><rect fill="#FFFFFF" filter="url(#f9fuwncr44an1)" height="152.5301" style="stroke: #000000; stroke-width: 2.0;" width="796" x="117" y="930.0123"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="142" x2="142" y1="63.7739" y2="1886.6627"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="453.5" x2="453.5" y1="63.7739" y2="1886.6627"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="565.5" x2="565.5" y1="63.7739" y2="1886.6627"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="693.5" x2="693.5" y1="63.7739" y2="1886.6627"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="810.5" x2="810.5" y1="63.7739" y2="1886.6627"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1112.5" x2="1112.5" y1="63.7739" y2="1886.6627"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1240.5" x2="1240.5" y1="63.7739" y2="1886.6627"/><rect fill="#FEFECE" filter="url(#f9fuwncr44an1)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="26" x="127" y="25.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="12" x="134" y="47.672">tx</text><rect fill="#FEFECE" filter="url(#f9fuwncr44an1)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="26" x="127" y="1885.6627"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="12" x="134" y="1907.6287">tx</text><rect fill="#FEFECE" filter="url(#f9fuwncr44an1)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="408.5" y="25.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="415.5" y="47.672">mnesia_tm</text><rect fill="#FEFECE" filter="url(#f9fuwncr44an1)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="408.5" y="1885.6627"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="415.5" y="1907.6287">mnesia_tm</text><rect fill="#FEFECE" filter="url(#f9fuwncr44an1)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="109" x="509.5" y="25.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="516.5" y="47.672">mnesia_locker</text><rect fill="#FEFECE" filter="url(#f9fuwncr44an1)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="109" x="509.5" y="1885.6627"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="516.5" y="1907.6287">mnesia_locker</text><rect fill="#FEFECE" filter="url(#f9fuwncr44an1)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="632.5" y="25.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="639.5" y="47.672">mnesia_recover</text><rect fill="#FEFECE" filter="url(#f9fuwncr44an1)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="632.5" y="1885.6627"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="639.5" y="1907.6287">mnesia_recover</text><rect fill="#FEFECE" filter="url(#f9fuwncr44an1)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="765.5" y="25.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="772.5" y="47.672">mnesia_tm</text><rect fill="#FEFECE" filter="url(#f9fuwncr44an1)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="765.5" y="1885.6627"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="772.5" y="1907.6287">mnesia_tm</text><rect fill="#FEFECE" filter="url(#f9fuwncr44an1)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="109" x="1056.5" y="25.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="1063.5" y="47.672">mnesia_locker</text><rect fill="#FEFECE" filter="url(#f9fuwncr44an1)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="109" x="1056.5" y="1885.6627"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="1063.5" y="1907.6287">mnesia_locker</text><rect fill="#FEFECE" filter="url(#f9fuwncr44an1)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="1179.5" y="25.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="1186.5" y="47.672">mnesia_recover</text><rect fill="#FEFECE" filter="url(#f9fuwncr44an1)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="1179.5" y="1885.6627"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="1186.5" y="1907.6287">mnesia_recover</text><rect fill="#FFFFFF" filter="url(#f9fuwncr44an1)" height="1772.1828" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="137" y="105.4799"/><rect fill="#FFFFFF" filter="url(#f9fuwncr44an1)" height="1622.0647" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="142" y="239.598"/><rect fill="#FFFFFF" filter="url(#f9fuwncr44an1)" height="137.5301" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="147" y="343.716"/><rect fill="#FFFFFF" filter="url(#f9fuwncr44an1)" height="1198.5925" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="147" y="618.3642"/><rect fill="#FFFFFF" filter="url(#f9fuwncr44an1)" height="389.0602" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="152" y="1165.9544"/><rect fill="#FFFFFF" filter="url(#f9fuwncr44an1)" height="42.706" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="157" y="1467.6026"/><rect fill="#FFFFFF" filter="url(#f9fuwncr44an1)" height="805.8263" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="806" y="973.4243"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="142" x2="189" y1="92.4799" y2="92.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="189" y1="92.4799" y2="105.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="148" x2="189" y1="105.4799" y2="105.4799"/><polygon fill="#A80036" points="158,101.4799,148,105.4799,158,109.4799,154,105.4799" style="stroke: #A80036; stroke-width: 1.0;"/><a href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1094" target="_top" title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1094" xlink:actuate="onRequest" xlink:href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1094" xlink:show="new" xlink:title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1094" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="126" x="154" y="86.6709">mnesia_tm:t_commit</text></a><line style="stroke: #A80036; stroke-width: 1.0;" x1="147" x2="189" y1="142.186" y2="142.186"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="189" y1="142.186" y2="155.186"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="148" x2="189" y1="155.186" y2="155.186"/><polygon fill="#A80036" points="158,151.186,148,155.186,158,159.186,154,155.186" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="154" y="136.377">mnesia_tm:intercept_friends</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="147" x2="189" y1="186.892" y2="186.892"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="189" y1="186.892" y2="199.892"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="148" x2="189" y1="199.892" y2="199.892"/><polygon fill="#A80036" points="158,195.892,148,199.892,158,203.892,154,199.892" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="154" y="181.083">mnesia_tm:arrange</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="147" x2="194" y1="226.598" y2="226.598"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="194" x2="194" y1="226.598" y2="239.598"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="153" x2="194" y1="239.598" y2="239.598"/><polygon fill="#A80036" points="163,235.598,153,239.598,163,243.598,159,239.598" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="159" y="220.789">mnesia_tm:multi_commit(Prep)</text><path d="M8,257.598 L8,302.598 L272,302.598 L272,267.598 L262,257.598 L8,257.598 " fill="#FBFB77" filter="url(#f9fuwncr44an1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M262,257.598 L262,267.598 L272,267.598 L262,257.598 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="14" y="276.495">Mnesia has 4 different commit protocols.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="14" y="294.201">We only consider</text><a href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1380" target="_top" title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1380" xlink:actuate="onRequest" xlink:href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1380" xlink:show="new" xlink:title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1380" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="62" x="119" y="294.201">sym_trans</text></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="30" x="184" y="294.201">here.</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="152" x2="199" y1="330.716" y2="330.716"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="199" x2="199" y1="330.716" y2="343.716"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="158" x2="199" y1="343.716" y2="343.716"/><polygon fill="#A80036" points="168,339.716,158,343.716,168,347.716,164,343.716" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="164" y="324.907">mnesia_tm:commit_nodes</text><path d="M43,361.716 L43,441.716 L236,441.716 L236,371.716 L226,361.716 L43,361.716 " fill="#FBFB77" filter="url(#f9fuwncr44an1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M226,361.716 L226,371.716 L236,371.716 L226,361.716 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="49" y="380.6131">Get list of nodes that contain</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="49" y="398.3191">disk and ram copies</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="49" y="416.0251">of tables affected by</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="49" y="433.7311">the transaction</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="157" x2="199" y1="480.2461" y2="480.2461"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="199" x2="199" y1="480.2461" y2="493.2461"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="152" x2="199" y1="493.2461" y2="493.2461"/><polygon fill="#A80036" points="162,489.2461,152,493.2461,162,497.2461,158,493.2461" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="164" y="474.4371">{DiskNs, RamNs}</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="152" x2="194" y1="519.9521" y2="519.9521"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="194" x2="194" y1="519.9521" y2="532.9521"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="153" x2="194" y1="532.9521" y2="532.9521"/><polygon fill="#A80036" points="163,528.9521,153,532.9521,163,536.9521,159,532.9521" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="159" y="514.1431">mnesia_checkpoint:tm_enter_pending</text><rect fill="#EEEEEE" filter="url(#f9fuwncr44an1)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1304.5" x="3" y="562.8052"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1307.5" y1="562.8052" y2="562.8052"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1307.5" y1="565.8052" y2="565.8052"/><rect fill="#EEEEEE" filter="url(#f9fuwncr44an1)" height="25.706" style="stroke: #000000; stroke-width: 2.0;" width="120" x="595.25" y="550.9521"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="103" x="601.25" y="568.8492">1st phase of 2PC</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="152" x2="199" y1="605.3642" y2="605.3642"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="199" x2="199" y1="605.3642" y2="618.3642"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="158" x2="199" y1="618.3642" y2="618.3642"/><polygon fill="#A80036" points="168,614.3642,158,618.3642,168,622.3642,164,618.3642" style="stroke: #A80036; stroke-width: 1.0;"/><a href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L2071" target="_top" title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L2071" xlink:actuate="onRequest" xlink:href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L2071" xlink:show="new" xlink:title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L2071" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="141" x="164" y="599.5552">mnesia_tm:ask_commit</text></a><path d="M117,638.3642 L190,638.3642 L190,647.3642 L180,657.3642 L117,657.3642 L117,638.3642 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="127.8241" style="stroke: #000000; stroke-width: 2.0;" width="942" x="117" y="638.3642"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="132" y="653.2612">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="196" x="205" y="652.1231">[for each #commit record in #prep]</text><polygon fill="#A80036" points="799,677.7762,809,681.7762,799,681.7762" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="157" x2="810" y1="681.7762" y2="681.7762"/><a href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L248" target="_top" title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L248" xlink:actuate="onRequest" xlink:href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L248" xlink:show="new" xlink:title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L248" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="72" x="164" y="675.9672">ask_commit</text></a><line style="stroke: #A80036; stroke-width: 1.0;" x1="811" x2="853" y1="713.4822" y2="713.4822"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="853" x2="853" y1="713.4822" y2="726.4822"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="812" x2="853" y1="726.4822" y2="726.4822"/><polygon fill="#A80036" points="822,722.4822,812,726.4822,822,730.4822,818,726.4822" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="229" x="818" y="707.6732">mnesia_checkpoint:tm_enter_pending</text><polygon fill="#A80036" points="168,754.1882,158,758.1882,168,758.1882" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="157" x2="810" y1="758.1882" y2="758.1882"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="174" y="752.3792">{vote_yes, Tid}</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="157" x2="199" y1="796.8943" y2="796.8943"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="199" x2="199" y1="796.8943" y2="809.8943"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="158" x2="199" y1="809.8943" y2="809.8943"/><polygon fill="#A80036" points="168,805.8943,158,809.8943,168,813.8943,164,809.8943" style="stroke: #A80036; stroke-width: 1.0;"/><a href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L2097" target="_top" title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L2097" xlink:actuate="onRequest" xlink:href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L2097" xlink:show="new" xlink:title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L2097" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="244" x="164" y="791.0853">receive nodes' votes and derive outcome</text></a><rect fill="#EEEEEE" filter="url(#f9fuwncr44an1)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1304.5" x="3" y="839.7473"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1307.5" y1="839.7473" y2="839.7473"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1307.5" y1="842.7473" y2="842.7473"/><rect fill="#EEEEEE" filter="url(#f9fuwncr44an1)" height="25.706" style="stroke: #000000; stroke-width: 2.0;" width="125" x="592.75" y="827.8943"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="108" x="598.75" y="845.7913">2nd phase of 2PC</text><path d="M51,868.6003 L51,913.6003 L228,913.6003 L228,878.6003 L218,868.6003 L51,868.6003 " fill="#FBFB77" filter="url(#f9fuwncr44an1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M218,868.6003 L218,878.6003 L228,878.6003 L218,868.6003 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="57" y="887.4973">broadcast the outcome to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="60" y="905.2033">the participants</text><path d="M117,930.0123 L190,930.0123 L190,939.0123 L180,949.0123 L117,949.0123 L117,930.0123 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="152.5301" style="stroke: #000000; stroke-width: 2.0;" width="796" x="117" y="930.0123"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="132" y="944.9093">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="150" x="205" y="943.7712">[for each participant node]</text><polygon fill="#A80036" points="794,969.4243,804,973.4243,794,973.4243" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="157" x2="805" y1="973.4243" y2="973.4243"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="164" y="967.6153">{Tid, Outcome = do_commit}</text><path d="M770,986.4243 L770,1013.4243 L848,1013.4243 L848,996.4243 L838,986.4243 L770,986.4243 " fill="#FBFB77" filter="url(#f9fuwncr44an1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M838,986.4243 L838,996.4243 L848,996.4243 L838,986.4243 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><a href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L273" target="_top" title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L273" xlink:actuate="onRequest" xlink:href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L273" xlink:show="new" xlink:title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L273" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="57" x="776" y="1005.3214">doit_loop</text></a><path d="M718,1028.1304 L718,1073.1304 L899,1073.1304 L899,1038.1304 L889,1028.1304 L718,1028.1304 " fill="#FBFB77" filter="url(#f9fuwncr44an1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M889,1028.1304 L889,1038.1304 L899,1038.1304 L889,1028.1304 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="724" y="1047.0274">lookup #participant record</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="727" y="1064.7334">from the state variable</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="157" x2="199" y1="1113.2484" y2="1113.2484"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="199" x2="199" y1="1113.2484" y2="1126.2484"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="158" x2="199" y1="1126.2484" y2="1126.2484"/><polygon fill="#A80036" points="168,1122.2484,158,1126.2484,168,1130.2484,164,1126.2484" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="164" y="1107.4394">mnesia_recover:note_decision(Tid, committed)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="157" x2="204" y1="1152.9544" y2="1152.9544"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="204" x2="204" y1="1152.9544" y2="1165.9544"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="163" x2="204" y1="1165.9544" y2="1165.9544"/><polygon fill="#A80036" points="173,1161.9544,163,1165.9544,173,1169.9544,169,1165.9544" style="stroke: #A80036; stroke-width: 1.0;"/><a href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1777" target="_top" title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1777" xlink:actuate="onRequest" xlink:href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1777" xlink:show="new" xlink:title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1777" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="119" x="169" y="1147.1454">mnesia_tm:do_dirty</text></a><path d="M44,1183.9544 L44,1246.9544 L235,1246.9544 L235,1193.9544 L225,1183.9544 L44,1183.9544 " fill="#FBFB77" filter="url(#f9fuwncr44an1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M225,1183.9544 L225,1193.9544 L235,1193.9544 L225,1183.9544 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="50" y="1202.8514">Mnesia logs #commit record</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="50" y="1220.5575">for the local node.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="50" y="1238.2635">See "Arrange" chapter below</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="162" x2="204" y1="1279.7785" y2="1279.7785"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="204" x2="204" y1="1279.7785" y2="1292.7785"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="163" x2="204" y1="1292.7785" y2="1292.7785"/><polygon fill="#A80036" points="173,1288.7785,163,1292.7785,173,1296.7785,169,1292.7785" style="stroke: #A80036; stroke-width: 1.0;"/><a href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_log.erl#L227" target="_top" title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_log.erl#L227" xlink:actuate="onRequest" xlink:href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_log.erl#L227" xlink:show="new" xlink:title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_log.erl#L227" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="90" x="169" y="1273.9695">mnesia_log:log</text></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="259" y="1273.9695">(#commit{})</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="816" x2="858" y1="1324.4845" y2="1324.4845"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="858" x2="858" y1="1324.4845" y2="1337.4845"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="817" x2="858" y1="1337.4845" y2="1337.4845"/><polygon fill="#A80036" points="827,1333.4845,817,1337.4845,827,1341.4845,823,1337.4845" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="823" y="1318.6755">mnesia_log:log(Commit)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="816" x2="858" y1="1369.1905" y2="1369.1905"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="858" x2="858" y1="1369.1905" y2="1382.1905"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="817" x2="858" y1="1382.1905" y2="1382.1905"/><polygon fill="#A80036" points="827,1378.1905,817,1382.1905,827,1386.1905,823,1382.1905" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="278" x="823" y="1363.3815">mnesia_recover:note_decision(Tid, committed)</text><rect fill="#EEEEEE" filter="url(#f9fuwncr44an1)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1304.5" x="3" y="1412.0435"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1307.5" y1="1412.0435" y2="1412.0435"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1307.5" y1="1415.0435" y2="1415.0435"/><rect fill="#EEEEEE" filter="url(#f9fuwncr44an1)" height="25.706" style="stroke: #000000; stroke-width: 2.0;" width="151" x="579.75" y="1400.1905"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="134" x="585.75" y="1418.0875">Post-commit actions</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="162" x2="209" y1="1454.6026" y2="1454.6026"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="209" x2="209" y1="1454.6026" y2="1467.6026"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="168" x2="209" y1="1467.6026" y2="1467.6026"/><polygon fill="#A80036" points="178,1463.6026,168,1467.6026,178,1471.6026,174,1467.6026" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="174" y="1448.7936">mnesia_tm:do_commit</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="167" x2="209" y1="1509.3086" y2="1509.3086"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="209" x2="209" y1="1509.3086" y2="1522.3086"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="162" x2="209" y1="1522.3086" y2="1522.3086"/><polygon fill="#A80036" points="172,1518.3086,162,1522.3086,172,1526.3086,168,1522.3086" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="6" x="174" y="1503.4996">?</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="162" x2="204" y1="1554.0146" y2="1554.0146"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="204" x2="204" y1="1554.0146" y2="1567.0146"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="157" x2="204" y1="1567.0146" y2="1567.0146"/><polygon fill="#A80036" points="167,1563.0146,157,1567.0146,167,1571.0146,163,1567.0146" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="6" x="169" y="1548.2056">?</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="816" x2="858" y1="1593.7206" y2="1593.7206"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="858" x2="858" y1="1593.7206" y2="1606.7206"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="817" x2="858" y1="1606.7206" y2="1606.7206"/><polygon fill="#A80036" points="827,1602.7206,817,1606.7206,827,1610.7206,823,1606.7206" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217" x="823" y="1587.9116">mnesia_tm:do_commit(Tid, Commit)</text><rect fill="#EEEEEE" filter="url(#f9fuwncr44an1)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="1304.5" x="3" y="1636.5736"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1307.5" y1="1636.5736" y2="1636.5736"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="1307.5" y1="1639.5736" y2="1639.5736"/><rect fill="#EEEEEE" filter="url(#f9fuwncr44an1)" height="25.706" style="stroke: #000000; stroke-width: 2.0;" width="71" x="619.75" y="1624.7206"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="54" x="625.75" y="1642.6176">Cleanup</text><polygon fill="#A80036" points="554,1680.1326,564,1684.1326,554,1688.1326,558,1684.1326" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="157" x2="560" y1="1684.1326" y2="1684.1326"/><a href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_locker.erl#L183" target="_top" title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_locker.erl#L183" xlink:actuate="onRequest" xlink:href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_locker.erl#L183" xlink:show="new" xlink:title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_locker.erl#L183" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="64" x="164" y="1678.3236">release_tid</text></a><polygon fill="#A80036" points="1101,1711.8387,1111,1715.8387,1101,1719.8387,1105,1715.8387" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="816" x2="1107" y1="1715.8387" y2="1715.8387"/><a href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_locker.erl#L183" target="_top" title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_locker.erl#L183" xlink:actuate="onRequest" xlink:href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_locker.erl#L183" xlink:show="new" xlink:title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_locker.erl#L183" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="64" x="823" y="1710.0297">release_tid</text></a><polygon fill="#A80036" points="442,1743.5447,452,1747.5447,442,1747.5447" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="157" x2="453" y1="1747.5447" y2="1747.5447"/><a href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L377" target="_top" title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L377" xlink:actuate="onRequest" xlink:href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L377" xlink:show="new" xlink:title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L377" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="111" x="164" y="1741.7357">delete_transaction</text></a><polygon fill="#A80036" points="168,1775.2507,158,1779.2507,168,1779.2507" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="157" x2="810" y1="1779.2507" y2="1779.2507"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="174" y="1773.4417">{WaitFor, Local}</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="157" x2="199" y1="1815.9567" y2="1815.9567"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="199" x2="199" y1="1815.9567" y2="1828.9567"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="152" x2="199" y1="1828.9567" y2="1828.9567"/><polygon fill="#A80036" points="162,1824.9567,152,1828.9567,162,1832.9567,158,1828.9567" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="164" y="1810.1477">do_commit</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="152" x2="194" y1="1860.6627" y2="1860.6627"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="194" x2="194" y1="1860.6627" y2="1873.6627"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="147" x2="194" y1="1873.6627" y2="1873.6627"/><polygon fill="#A80036" points="157,1869.6627,147,1873.6627,157,1877.6627,153,1873.6627" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="159" y="1854.8537">do_commit</text><!--MD5=[d4990687ff0d95d06c701b683e5737ee]
@startuml
box "Original node" #White
  participant tx as tx
  participant mnesia_tm as tm
  participant mnesia_locker as locker
  participant mnesia_recover as recover
end box

box "Participant A" #LightBlue
  participant mnesia_tm as tm_a
  participant mnesia_locker as locker_a
  participant mnesia_recover as recover_a
end box

tx -> tx ++ : [[https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1094 mnesia_tm:t_commit]]
  tx -> tx : mnesia_tm:intercept_friends

  tx -> tx : mnesia_tm:arrange

  tx -> tx ++ : mnesia_tm:multi_commit(Prep)
    note over tx : Mnesia has 4 different commit protocols.\nWe only consider [[https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1380 sym_trans]] here.

    tx -> tx ++ : mnesia_tm:commit_nodes
      note over tx : Get list of nodes that contain\ndisk and ram copies\nof tables affected by\nthe transaction
    return {DiskNs, RamNs}

    tx -> tx : mnesia_checkpoint:tm_enter_pending

== 1st phase of 2PC ==
    tx -> tx ++ : [[https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L2071 mnesia_tm:ask_commit]]
      loop for each #commit record in #prep
        tx -\ tm_a : [[https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L248 ask_commit]]
        tm_a -> tm_a : mnesia_checkpoint:tm_enter_pending
        tx /- tm_a : {vote_yes, Tid}
      end

      tx -> tx : [[https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L2097 receive nodes' votes and derive outcome]]

== 2nd phase of 2PC ==
    note over tx : broadcast the outcome to\n the participants
    loop for each participant node
        tx -\ tm_a : {Tid, Outcome = do_commit}
        activate tm_a
        note over tm_a : [[https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L273 doit_loop]]
        note over tm_a : lookup #participant record\n from the state variable
    end

    tx -> tx : mnesia_recover:note_decision(Tid, committed)

    tx -> tx ++ : [[https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1777 mnesia_tm:do_dirty]]
      note over tx: Mnesia logs #commit record\nfor the local node.\nSee "Arrange" chapter below
      tx -> tx : [[https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_log.erl#L227 mnesia_log:log]](#commit{})

        tm_a -> tm_a : mnesia_log:log(Commit)
        tm_a -> tm_a : mnesia_recover:note_decision(Tid, committed)

== Post-commit actions ==
    tx -> tx ++ : mnesia_tm:do_commit


      return ?
    return ?

    tm_a -> tm_a : mnesia_tm:do_commit(Tid, Commit)

== Cleanup ==
    tx -> locker : [[https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_locker.erl#L183 release_tid]]
    tm_a -> locker_a : [[https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_locker.erl#L183 release_tid]]


    tx -\ tm : [[https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L377 delete_transaction]]
    return {WaitFor, Local}
  return do_commit
return do_commit
@enduml

PlantUML version 1.2020.02(Sun Mar 01 11:22:07 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.11+9-Ubuntu-0ubuntu2.20.10
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>