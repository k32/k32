<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="463px" preserveAspectRatio="none" style="width:1009px;height:463px;" version="1.1" viewBox="0 0 1009 463" width="1009px" zoomAndPan="magnify"><defs><filter height="300%" id="fphpco9k34dgw" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" height="448.49" style="stroke: #A80036; stroke-width: 1.0;" width="518.5" x="123" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="89" x="337.75" y="17.897">Original node</text><rect fill="#ADD8E6" height="448.49" style="stroke: #A80036; stroke-width: 1.0;" width="355" x="643.5" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="86" x="778" y="17.897">Participant A</text><rect fill="#FFFFFF" filter="url(#fphpco9k34dgw)" height="280.9421" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="137" y="105.4799"/><rect fill="#FFFFFF" filter="url(#fphpco9k34dgw)" height="102.118" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="142" y="239.598"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="142" x2="142" y1="63.7739" y2="411.4221"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="335.5" x2="335.5" y1="63.7739" y2="411.4221"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="447.5" x2="447.5" y1="63.7739" y2="411.4221"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="575.5" x2="575.5" y1="63.7739" y2="411.4221"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="692.5" x2="692.5" y1="63.7739" y2="411.4221"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="804.5" x2="804.5" y1="63.7739" y2="411.4221"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="932.5" x2="932.5" y1="63.7739" y2="411.4221"/><rect fill="#FEFECE" filter="url(#fphpco9k34dgw)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="26" x="127" y="25.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="12" x="134" y="47.672">tx</text><rect fill="#FEFECE" filter="url(#fphpco9k34dgw)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="26" x="127" y="410.4221"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="12" x="134" y="432.388">tx</text><rect fill="#FEFECE" filter="url(#fphpco9k34dgw)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="290.5" y="25.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="297.5" y="47.672">mnesia_tm</text><rect fill="#FEFECE" filter="url(#fphpco9k34dgw)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="290.5" y="410.4221"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="297.5" y="432.388">mnesia_tm</text><rect fill="#FEFECE" filter="url(#fphpco9k34dgw)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="109" x="391.5" y="25.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="398.5" y="47.672">mnesia_locker</text><rect fill="#FEFECE" filter="url(#fphpco9k34dgw)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="109" x="391.5" y="410.4221"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="398.5" y="432.388">mnesia_locker</text><rect fill="#FEFECE" filter="url(#fphpco9k34dgw)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="514.5" y="25.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="521.5" y="47.672">mnesia_recover</text><rect fill="#FEFECE" filter="url(#fphpco9k34dgw)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="514.5" y="410.4221"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="521.5" y="432.388">mnesia_recover</text><rect fill="#FEFECE" filter="url(#fphpco9k34dgw)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="647.5" y="25.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="654.5" y="47.672">mnesia_tm</text><rect fill="#FEFECE" filter="url(#fphpco9k34dgw)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="647.5" y="410.4221"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="654.5" y="432.388">mnesia_tm</text><rect fill="#FEFECE" filter="url(#fphpco9k34dgw)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="109" x="748.5" y="25.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="755.5" y="47.672">mnesia_locker</text><rect fill="#FEFECE" filter="url(#fphpco9k34dgw)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="109" x="748.5" y="410.4221"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="755.5" y="432.388">mnesia_locker</text><rect fill="#FEFECE" filter="url(#fphpco9k34dgw)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="871.5" y="25.706"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="878.5" y="47.672">mnesia_recover</text><rect fill="#FEFECE" filter="url(#fphpco9k34dgw)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="871.5" y="410.4221"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="878.5" y="432.388">mnesia_recover</text><rect fill="#FFFFFF" filter="url(#fphpco9k34dgw)" height="280.9421" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="137" y="105.4799"/><rect fill="#FFFFFF" filter="url(#fphpco9k34dgw)" height="102.118" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="142" y="239.598"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="142" x2="189" y1="92.4799" y2="92.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="189" y1="92.4799" y2="105.4799"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="148" x2="189" y1="105.4799" y2="105.4799"/><polygon fill="#A80036" points="158,101.4799,148,105.4799,158,109.4799,154,105.4799" style="stroke: #A80036; stroke-width: 1.0;"/><a href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1094" target="_top" title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1094" xlink:actuate="onRequest" xlink:href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1094" xlink:show="new" xlink:title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1094" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="126" x="154" y="86.6709">mnesia_tm:t_commit</text></a><line style="stroke: #A80036; stroke-width: 1.0;" x1="147" x2="189" y1="142.186" y2="142.186"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="189" y1="142.186" y2="155.186"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="148" x2="189" y1="155.186" y2="155.186"/><polygon fill="#A80036" points="158,151.186,148,155.186,158,159.186,154,155.186" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="154" y="136.377">mnesia_tm:intercept_friends</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="147" x2="189" y1="186.892" y2="186.892"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="189" x2="189" y1="186.892" y2="199.892"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="148" x2="189" y1="199.892" y2="199.892"/><polygon fill="#A80036" points="158,195.892,148,199.892,158,203.892,154,199.892" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="154" y="181.083">mnesia_tm:arrange</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="147" x2="194" y1="226.598" y2="226.598"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="194" x2="194" y1="226.598" y2="239.598"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="153" x2="194" y1="239.598" y2="239.598"/><polygon fill="#A80036" points="163,235.598,153,239.598,163,243.598,159,239.598" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="159" y="220.789">multi_commit</text><path d="M8,257.598 L8,302.598 L272,302.598 L272,267.598 L262,257.598 L8,257.598 " fill="#FBFB77" filter="url(#fphpco9k34dgw)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M262,257.598 L262,267.598 L272,267.598 L262,257.598 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="243" x="14" y="276.495">Mnesia has 4 different commit protocols.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="14" y="294.201">We only consider</text><a href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1380" target="_top" title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1380" xlink:actuate="onRequest" xlink:href="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1380" xlink:show="new" xlink:title="https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1380" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="62" x="119" y="294.201">sym_trans</text></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="30" x="184" y="294.201">here.</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="152" x2="194" y1="340.716" y2="340.716"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="194" x2="194" y1="340.716" y2="353.716"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="147" x2="194" y1="353.716" y2="353.716"/><polygon fill="#A80036" points="157,349.716,147,353.716,157,357.716,153,353.716" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="159" y="334.907">do_commit</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="147" x2="189" y1="385.4221" y2="385.4221"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="189" x2="189" y1="385.4221" y2="398.4221"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="142" x2="189" y1="398.4221" y2="398.4221"/><polygon fill="#A80036" points="152,394.4221,142,398.4221,152,402.4221,148,398.4221" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="154" y="379.6131">do_commit</text><!--MD5=[078250ef93aadc653e92931795293634]
@startuml
box "Original node" #White
  participant tx as tx
  participant mnesia_tm as tm
  participant mnesia_locker as locker
  participant mnesia_recover as recover
end box

box "Participant A" #LightBlue
  participant mnesia_tm as tm_a
  participant mnesia_locker as locker_a
  participant mnesia_recover as recover_a
end box

tx -> tx ++ : [[https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1094 mnesia_tm:t_commit]]
  tx -> tx : mnesia_tm:intercept_friends

  tx -> tx : mnesia_tm:arrange

  tx -> tx ++ : multi_commit
    note over tx : Mnesia has 4 different commit protocols.\nWe only consider [[https://github.com/erlang/otp/blob/OTP-24.0/lib/mnesia/src/mnesia_tm.erl#L1380 sym_trans]] here.
  return do_commit
return do_commit
@enduml

PlantUML version 1.2020.02(Sun Mar 01 11:22:07 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.11+9-Ubuntu-0ubuntu2.20.10
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>